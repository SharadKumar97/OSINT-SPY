import requests
from threading import Timer
from modules.config import *

def getReport():
    try:
        params2 = {'apikey': virus_total_api_key,
                    'resource':resource}
        headers2 = {
            "Accept-Encoding": "gzip,deflate",
            "User-Agent": "gzip, OSINT-SPY"
            }
        response2 = requests.get('https://www.virustotal.com/vtapi/v2/file/report', params=params2, headers=headers2)
        json_response2 = response2.json()
        print("Scan_ID :: " + json_response2['scan_id'])
        print("SHA1 Hash :: " + json_response2['sha1'])
        print("Scan_Date :: " + json_response2['scan_date'])
        print("Report Link :: " + json_response2['permalink'])
        print("Scan Status :: " + json_response2['verbose_msg'])
        print("List of  Anti-Virus response :: \n")
        for scan in json_response2['scans'].keys():
            print(scan + " :: " + str(json_response2['scans'][scan]['detected']))
    except:
        print("Try Again")

def sendMalware(mal_name):
    try:
        global resource
        params={'apikey':virus_total_api_key}
        files={'file':(mal_name,open(mal_name,'rb'))}
        response=requests.post('https://www.virustotal.com/vtapi/v2/file/scan',files=files,params=params)
        json_response=response.json()
        resource=json_response['resource']
        print("Scan Link :: "+ json_response['permalink'])
        print("SHA1 Hash :: "+ json_response['sha1'])
        print("Resource ID ::"+json_response['resource'])
        print("Scan ID :: "+ json_response['scan_id'])
        print("Scan Status :: "+ json_response['verbose_msg'])
        print("\n")
        print("Malware sample is submitted!! Wait for 5 Minutes !! Please do not stop this script !!")
        print("\n")
        t=Timer(300.0,getReport)
        t.start()
    except:
        print("Try Again")
